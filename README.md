# TTS情绪路由插件 v0.3.0

一个智能的TTS（文本转语音）插件，能够根据消息情绪自动选择不同的音色，并智能处理代码和链接内容。

## ✨ 新功能 v0.3.0

### 📖 代码和链接智能提取
插件现在能够自动识别消息中的代码片段和链接，并以优雅的方式展示：

- **代码提取**：自动识别各种编程语言的代码块
- **链接提取**：提取消息中的URL链接
- **智能展示**：在TTS语音后，以文本形式补充展示提取的内容

### 🎯 优化输出体验
- **TTS语音**：输出完整的消息内容
- **文本补充**：仅显示提取的代码和链接，避免内容重复
- **自然展示**：移除了多余的标题文字，展示更加简洁

## 🚀 主要功能

1. **情绪识别与路由**
   - 支持四种基本情绪：happy（开心）、sad（伤心）、angry（生气）、neutral（平静）
   - 使用启发式算法智能判断消息情绪
   - 支持隐藏情绪标记 `[EMO:xxx]` 进行精确控制

2. **多音色支持**
   - 可以为不同情绪配置不同的音色
   - 支持语速调节，为不同情绪设置不同的说话速度

3. **智能内容处理**
   - 自动提取和展示代码片段
   - 自动提取和展示链接
   - 技术术语保护，避免误识别

4. **灵活的会话管理**
   - 支持全局开关和会话级别开关
   - 支持黑名单和白名单模式
   - 可设置触发概率、冷却时间等

## 📦 安装

1. 将插件文件夹 `astrbot_plugin_tts_emotion_router` 放入 AstrBot 的 `data/plugins/` 目录下
2. 重启 AstrBot 或在插件管理页面重新加载插件

## ⚙️ 配置

插件支持在 AstrBot 的配置面板中进行可视化配置，主要配置项包括：

### API配置
- `api.url`: TTS API 地址
- `api.key`: API 密钥
- `api.model`: 使用的模型（默认：gpt-tts-pro）
- `api.format`: 音频格式（默认：mp3）
- `api.speed`: 默认语速（默认：1.0）
- `api.gain`: 音量增益（默认：5.0 dB）

### 音色映射
为不同情绪配置对应的音色：
```json
{
  "voice_map": {
    "happy": "voice_id_1",
    "sad": "voice_id_2",
    "angry": "voice_id_3",
    "neutral": "voice_id_4"
  }
}
```

### 语速映射
为不同情绪配置语速：
```json
{
  "speed_map": {
    "happy": 1.2,
    "sad": 0.9,
    "angry": 1.3,
    "neutral": 1.0
  }
}
```

### 情绪标记
```json
{
  "emotion": {
    "marker": {
      "enable": true,
      "tag": "EMO"
    }
  }
}
```

## 🎮 使用方法

### 基础命令
- `/tts_on` / `tts_off`：开启/关闭当前会话的TTS
- `/tts_global_on` / `tts_global_off`：开启/关闭全局TTS
- `/tts_status`：查看当前状态
- `/tts_prob <0-1>`：设置触发概率
- `/tts_limit <数字>`：设置字数限制
- `/tts_cooldown <秒数>`：设置冷却时间

### 情绪控制
- `/tts_emote <happy|sad|angry|neutral>`：手动指定下一条消息的情绪
- `/tts_marker_on` / `/tts_marker_off`：开启/关闭隐藏情绪标记

### 混合输出
- `/tts_mixed_on` / `/tts_mixed_off`：开启/关闭混合输出模式

### 测试和调试
- `/tts_test [文本]`：测试TTS功能
- `/tts_debug`：查看调试信息
- `/tts_gain <-10~10>`：调节音量增益
- `/tts_check_refs`：检查参考文献配置

## 💡 使用技巧

1. **代码和链接展示**
   - 当消息包含代码或链接时，TTS会朗读完整内容
   - 文本消息会自动补充显示提取的代码和链接
   - 无需任何额外配置，智能识别和展示

2. **情绪控制**
   - 可以通过命令手动指定情绪
   - 开启隐藏标记后，LLM会自动在回复前添加情绪标记
   - 适合需要精确控制语音情绪的场景

3. **性能优化**
   - 合理设置冷却时间，避免频繁触发
   - 使用概率控制，减少不必要的TTS生成
   - 设置合适的字数限制，避免过长的语音

## 🔧 故障排除

### TTS无法生成
1. 检查API配置是否正确
2. 确认网络连接正常
3. 使用 `/tts_debug` 查看详细状态
4. 使用 `/tts_test` 测试TTS功能

### 代码/链接无法显示
1. 确认消息中包含合法的代码块（```）或链接
2. 检查 `/tts_check_refs` 查看配置状态
3. 查看日志中的提取信息

### 音质问题
1. 使用 `/tts_gain` 调节音量
2. 检查音频格式设置
3. 尝试更换不同的音色

## 📝 更新日志

### v0.3.0 (2024-08-30)
- ✨ 新增代码和链接智能提取功能
- 🎯 优化输出体验，避免内容重复
- 📖 移除多余的标题文字，展示更简洁
- 🛠️ 修复 allow_mixed 配置的相关问题

### v0.2.0
- 🎭 新增情绪标记支持
- 🔧 优化音频文件处理
- 📊 增强调试功能

### v0.1.1
- 🎉 初始版本发布
- 🎵 基础TTS功能
- 😊 情绪路由功能

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个插件！

## 📄 许可证

MIT License
